pipeline {
	agent any
	parameters {
		choice(name: 'NETWORK', choices: ['STAGING', 'PRODUCTION'], description: 'The network to clone from and activate to')
		string(name: 'CONFIGNAME', defaultValue: "bigmanuel-eu.edgesuite-staging.net", description: 'The domain you are adding to the configuration') 
	}
	environment {
    	PROJ = "/bin:/usr/local/bin:/usr/bin"
	}
	stages {
		stage('CreateNewVersion') {
			steps {
				withEnv(["PATH+EXTRA=$PROJ"]) {
					//sh "akamai appsec configs --section default --json | jq '.configurations[] | select (.name | test (\"gss-ta-demo\"))'"
					//sh "akamai appsec --section default clone --config=40539 --version=STAGING"
					//${NETWORK}"
					echo "OK"
				}
			}
		}
		stage('AddHostname') {
			steps {
				withEnv(["PATH+EXTRA=$PROJ"]) {
					//sh "akamai appsec --section default add-hostname --config=40539 ${CONFIGNAME}"
					echo "also OK"
				}
			}
		}
		stage('ClonePolicy') {
			steps {
				withEnv(["PATH+EXTRA=$PROJ"]) {
					script {
                 	   def returnShell = sh(script: "akamai appsec --section default clone-policy ODPP_78900 --config=40539  --prefix=${env.BUILD_ID}DPP  --json | jq '.policyId'", returnStdout: true).trim()
                 	   println("returnShell = ${returnShell}")
                 	   archiveArtifacts "returnShell"
                	}
                	

					/*
					OUTPUT = sh (
						script: "ls",
						returnStdout: true
					).trim()
					echo "OUTPUT: ${OUTPUT}"
 
					I am mising updating the 'Bypass Network List'. I do not know how to save the output and move on
					
					def returnShell = sh "akamai appsec --section default clone-policy ODPP_78900 --config=40539  --prefix=${env.BUILD_ID}DPP  --json | jq '.policyId'" 
					archiveArtifacts "returnShell"
					echo "returnShell=$returnShell"

					def reader = readFile('policyId')
					echo reader
					reader

										sh "akamai appsec --section default clone-policy ODPP_78900 --config=40539  --prefix=${env.BUILD_ID}DPP  --json | jq '.policyId'"  > policyId
					def output=readFile('policyId').trim()
					echo "output=$output";

					*/
				}
			}
		}
	}
}
